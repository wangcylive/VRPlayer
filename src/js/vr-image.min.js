!function(e){function t(){return"undefined"!=typeof TransitionEvent?"transitionend":"undefined"!=typeof WebKitTransitionEvent?"webkitTransitionEnd":void 0}function n(e){function t(e){return"-"+e.toLowerCase()}return e.indexOf("-")!==-1?e.toLowerCase():e.replace(/^[A-Z]/,function(e){return e.toLowerCase()}).replace(/^(webkit|moz|ms|o)/i,function(e){return"-"+e}).replace(/[A-Z]/g,t)}function i(e,t){return new i.fn.init(e,t)}var r=e(),o=window,s=document,a=s.body,l=r(o),c=(r(s),r(a)),u=["您的浏览器不支持全景图片","您的浏览器不支持陀螺仪","您的浏览器不支持全屏","图片加载失败"],f=100,h=75,d=30,m=120,p=0,v="active",y=function(){var e=navigator.userAgent;return{mobile:/Mobile|Android|Symbian/i.test(e),android:/Android|Adr/i.test(e),ios:/iPhone|iPad|iPod/i.test(e),symbian:/Symbian/i.test(e),windowsPhone:/Windows Phone/i.test(e),blankBerry:/BB/i.test(e),weChat:/MicroMessenger/i.test(e),qq:/MQQBrowser/i.test(e),uc:/UCBrowser/i.test(e),chrome:/Chrome\/[\d\.]+ Mobile Safari\/[\d\.]+$/i.test(e),firefox:/Firefox/i.test(e),ie:/MSIE/i.test(e),ie11:/Trident\/7\.0/i.test(e),edge:/Edge/i.test(e)}}(),g=function(){for(var e,t=s.createElement("canvas"),n=["webgl","experimental-webgl"],i=0;i<n.length;i++)try{if(e=t.getContext(n[i]))break}catch(r){}return!!e}(),E=g;o.requestAnimationFrame=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,o.cancelAnimationFrame=o.cancelAnimationFrame||o.mozCancelAnimationFrame,r.createElem=function(e,t){if("string"==typeof e&&(e=r.trim(e))){var n=s.createElement(e);return"string"==typeof t&&(t=r.trim(t))&&(n.className=t),r(n)}};var w=function(){var e,t=["","-webkit-","-moz-","-ms-","-o-"],i=s.createElement("div"),r=i.style;return function(i){i=n(i);for(var o=0,s=t.length;o<s;o++)if(e="",e=t[o]?t[o]+i:i,e in r)return e}}();(function(){return!("undefined"==typeof AnimationEvent&&"undefined"==typeof WebKitAnimationEvent)})(),function(){return!("undefined"==typeof TransitionEvent&&"undefined"==typeof WebKitTransitionEvent)}(),function(){var e=!1;try{var t=s.createEvent("TouchEvent");t.initEvent("touchstart"),e=!0}catch(n){}return e}();l.one("deviceorientation",function(e){p=null!==e.alpha,i.fn.supportOrientation=p,i.fn.testedOrientation=!0,"function"==typeof i.deviceorientation&&i.deviceorientation(p)});var b=function(){function e(e){r&&"function"==typeof e&&(s.addEventListener(r,e,!1),d.push(e))}function t(){d.forEach(function(e){s.removeEventListener(r,e,!1)})}function n(){c?"function"==typeof l&&l.call(a):console.info("unable fullscreen")}function i(){"function"==typeof u&&u.call(s)}var r,o,a=s.documentElement,l=a.requestFullscreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen,c=s.fullscreenEnabled||s.webkitFullscreenEnabled||s.mozFullScreenEnabled||s.msFullscreenEnabled||!0,u=s.exitFullscroll||s.webkitCancelFullScreen||s.mozCancelFullScreen||s.msExitFullscreen,f=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],h=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"];f.some(function(e){if("on"+e in s)return r=e}),h.some(function(e){if(e in s)return o=e});var d=[];return{on:e,off:t,request:n,exit:i,fullscreenElement:o}}(),C=w("transition"),T=(w("transform"),t());i.fn=i.prototype={version:"1.1.0",constructor:i,fullscreen:function(){if(this.main){var e=r(this.main),t="is-fullscreen";e.hasClass(t)?(b.exit(),c.removeClass("vr-full"),e.removeClass(t)):(b.request(),c.removeClass("vr-full"),e.addClass(t))}return this},on:function(e,t){var n=this.image;return n&&"string"==typeof e&&(e=r.trim(e))&&"function"==typeof t&&r(n).on(e,t),this},toast:function(){function e(e){return i.textContent=e,l.display="block",o=1,clearTimeout(n),n=setTimeout(function(){l.display="none",o=0},r)}function t(){o&&(clearTimeout(n),l.display="none",o=0)}var n,i=s.getElementById("toast"),r=4e3,o=0;null===i&&(i=s.createElement("div"),i.id="toast",i.className="toast",i.style.display="none",a.appendChild(i));var l=i.style;return s.addEventListener("click",t,!0),s.addEventListener("touchend",t,!0),e}(),supportWebGL:g,supportVR:E,supportOrientation:p},i.fn.init=function(e,t){function n(e){e.wheelDeltaY?q.fov-=.05*e.wheelDeltaY:e.wheelDelta?q.fov-=.05*e.wheelDelta:e.detail&&(q.fov+=1*e.detail),q.fov=Math.min(m,Math.max(d,q.fov)),D.fov=q.fov,D.updateProjectionMatrix()}function i(){return D.aspect=e.clientWidth/e.clientHeight,D.updateProjectionMatrix(),V.setSize(e.clientWidth,e.clientHeight),y.mobile&&y.uc&&(K.needsUpdate=!0),V.render(Y,D),q}function o(t){he=0,de=e.clientWidth,me=e.clientHeight;var n=t.targetTouches,i=n[0];if(1===n.length&&void 0===J&&(ie=1,J=i.identifier,se=re,ae=oe,le=i.clientX,ce=i.clientY),2===n.length){ie=0;var r=n[0],o=n[1],s=Math.abs(r.clientX-o.clientX),a=Math.abs(r.clientY-o.clientY);_=Math.sqrt(Math.pow(s,2)+Math.pow(a,2)),ee=D.fov}}function a(e){e.preventDefault(),he=1;var t=e.targetTouches,n=e.changedTouches,i=n[0];if(J===i.identifier&&ie&&(ue=le-i.clientX,fe=i.clientY-ce,re=ue/me*1.5*q.fov/h+se,oe=fe/me*1.5*q.fov/h+ae),t.length>1){var r=t[0],o=t[1],s=Math.abs(r.clientX-o.clientX),a=Math.abs(r.clientY-o.clientY),l=Math.sqrt(Math.pow(s,2)+Math.pow(a,2))-_;q.fov=ee-.2*l,q.fov=Math.min(m,Math.max(d,q.fov)),D.fov=q.fov,D.updateProjectionMatrix()}}function g(e){var t=e.targetTouches,n=t[0],i=e.changedTouches,r=i[0];J===r.identifier&&(ie=0,J=void 0),1===t.length&&(ie=1,J=n.identifier,se=re,ae=oe,le=n.clientX,ce=n.clientY)}function w(t){ie=1,he=0,se=re,ae=oe,le=t.clientX,ce=t.clientY,de=e.clientWidth,me=e.clientHeight}function M(e){e.preventDefault(),he=1,ie&&(ue=le-e.clientX,fe=e.clientY-ce,re=ue/me*1.5*q.fov/h+se,oe=fe/me*1.5*q.fov/h+ae)}function x(e){ie=0}function F(){clearTimeout(te),ne=0,j.show(),setTimeout(function(){j.css(C,"all .4s").css("opacity",1)},10),te=setTimeout(function(){j.css(C,"all .6s").css("opacity",0),ne=1},4e3)}function O(){return q.isVRView=1,V=B,b.request(),p&&(U.connect(),q.isOrientation=1),c.addClass("vr-full"),H.addClass("is-vr"),j.show(),clearTimeout(te),te=setTimeout(function(){j.css(C,"all .6s").css("opacity",0),ne=1},3e3),H.on("click",F),i(),q}function A(){return q.isVRView=0,V=X,U.disconnect(),q.isOrientation=0,W.removeClass(v),b.exit(),c.removeClass("vr-full"),H.removeClass("is-vr"),clearTimeout(te),j.hide(),H.off("click",F),N.removeClass(v),i(),q}function R(){return p?(q.isOrientation?(U.disconnect(),W.removeClass(v)):(U.connect(),W.addClass(v)),q.isOrientation=!q.isOrientation):q.toast(u[1]),q}if(!e||1!==e.nodeType)throw new TypeError("Failed to 'imageVR' arguments, 1 argument must be 'Element'");if(!t||"string"!=typeof t.src)throw new TypeError("Failed to 'imageVR' arguments, 2 argument must be 'Object' and attribute 'src' must be 'String'");var S={};!function(){var e;for(e in t)t.hasOwnProperty(e)&&(S[e]=t[e])}();var q=this,H=r(e),k=r.createElem("div","ratio-vr"),P=r.createElem("div","ul-vr"),j=r.createElem("div","exit-vr"),L=r.createElem("div","controls-vr"),z=r.createElem("button","stereo"),N=r.createElem("button","fullscreen"),W=r.createElem("button","orientation");H.append(k),H.addClass("image-vr"),isNaN(S.ratio)||k.css("padding-top",100*S.ratio+"%"),j.text("退出VR视角");var V,Y,D,X,B,I,$,G,K,Q,U,Z,J,_,ee,te,ne,ie=0,re=0,oe=0,se=0,ae=0,le=0,ce=0,ue=0,fe=0,he=!1,de=e.clientWidth,me=e.clientHeight;j.on(T,function(){1===ne&&(j.hide(),ne=0)},!1);var pe=new Image;pe.crossOrigin="anonymous",q.image=pe,q.main=e,E&&(this.fov=h,this.isVRView=0,this.isOrientation=0,V=X=new THREE.WebGLRenderer,B=new THREE.StereoEffect(V),D=new THREE.PerspectiveCamera(h,e.clientWidth/e.clientHeight,1,1e3),Y=new THREE.Scene,U=new THREE.DeviceOrientationControls(D),pe.onload=function(){pe.onload=null,L.append(z).append(N).append(W),H.append(L).append(j).append(P).addClass("is-ready");var e=this.width,t=this.height;e/t!==2&&console.warn("The image size does not conform to the panoramic display, will produce deformation."),K=new THREE.Texture(pe),K.needsUpdate=!0,G=new THREE.MeshBasicMaterial({map:K}),$=new THREE.SphereBufferGeometry(f,60,60),$.scale(-1,1,1),I=new THREE.Mesh($,G),Y.add(I),V.render(Y,D),l.on("resize",i),P.on("mousedown",w).on("touchstart",o).on("mousemove",M).on("touchmove",a),P.on("mouseup mouseout touchcancel",x).on("touchend",g),z.on("click",O),W.on("click",R),j.on("click",A),H.on("mousewheel MozMousePixelScroll",n),N.on("click",function(){H.hasClass("is-fullscreen")?(b.exit(),c.removeClass("vr-full"),H.removeClass("is-fullscreen"),N.removeClass(v)):(b.request(),c.addClass("vr-full"),H.addClass("is-fullscreen"),N.addClass(v)),i()}),b.on(function(){s[b.fullscreenElement]!==s.documentElement&&(c.removeClass("vr-full"),H.removeClass("is-fullscreen"),N.removeClass(v)),i()});var r=function(){oe=Math.max(-Math.PI/2,Math.min(Math.PI/2,oe));var e=f*Math.cos(re)*Math.cos(oe),t=f*Math.sin(oe),n=f*Math.sin(re)*Math.cos(oe),i=new THREE.Vector3(e,t,n);q.isOrientation?U.update():D.lookAt(i),V.render(Y,D),Z=requestAnimationFrame(r)};r(),q.resize=i,q.requestStereo=O,q.exitStereo=A,q.changeOrientation=R},pe.onerror=function(){throw pe.onerror=null,q.toast(u[3]),new Error("Image resource loading errors.")},pe.src=S.src,V.setSize(e.clientWidth,e.clientHeight),V.setClearColor(6710886),Q=V.domElement,H.append(Q))},i.fn.init.prototype=i.prototype,"function"==typeof define&&define.amd?define(["three","three-extend"],function(){return i}):"object"==typeof exports?module.exports=i:window.imageVR=i}(function(){function e(e){return e.hasOwnProperty(c)||Object.defineProperty(e,c,{value:++u}),e[c]}function t(e,t){if(e.hasOwnProperty(c)){var n=e[c],i=f[t];if(i&&(i=i.filter(function(e){return e.guid===n}),i.length>0))return i}return[]}function n(e,t){var n=[];return t=t||{bubbles:!1,cancelable:!1,detail:null},"string"==typeof e&&(e=s.trim(e))&&(e=e.split(/\s+/),e.forEach(function(e){n.push(new CustomEvent(e,t))})),n}function i(e){var t=this;f[e.type]&&f[e.type].filter(function(e){return e.guid===t[c]}).forEach(function(n){if(null==n.selector)n.handler.call(t,e);else{var i=[];try{i=m.slice.call(t.querySelectorAll(n.selector),0)}catch(r){}for(var o=e.target;o!==t;)-1!==i.indexOf(o)&&n.handler.call(o,e),o=o.parentNode}})}function r(t,n){for(var i,r,a=0;a<t.length;a++){i=t[a],r=i.style;var l=e(i);n?(r.display="",s.isHidden(i)?h.hasOwnProperty(l)?r.display=h[l]:r.display=h[l]=o(i.nodeName):h[l]=s.css(i,"display")):s.isHidden(i)||(h[l]=s.css(i,"display"),r.display="none")}}function o(e){var t=document.createElement(e);document.body.appendChild(t);var n=s.css(t,"display");return document.body.removeChild(t),n}var s=function(e){return new s.fn.init(e)},a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,l="1.0.0",c="JQ"+(l+Math.random()).replace(/\D/g,""),u=0;s.expando=c;var f={},h={};!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}();var d=Object.prototype.toString,m=Array.prototype;return s.css=function(e,t){if(e&&1===e.nodeType)return window.getComputedStyle(e,null)[t]},s.isHidden=function(e){return"none"===s.css(e,"display")},s.trim=function(e){return null==e?"":(e+"").replace(a,"")},s.isArray=function(e){return Array.isArray(e)},s.isObject=function(e){return"[object Object]"===d.call(e)},s.fn=s.prototype={constructor:s,eq:function(e){if("number"==typeof e){var t=this[e];return s.fn.init(t)}return this},first:function(){return s.fn.eq.call(this,0)},last:function(){var e=this.length-1;return s.fn.eq.call(this,e)},append:function(e){var t=document.createDocumentFragment();return e instanceof s||/^\[object (NodeList|HTMLCollection)]$/.test(d.call(e))?this.last()[0]&&(m.slice.call(e).forEach(function(e){t.appendChild(e)}),this.last()[0].appendChild(t)):"string"==typeof e?this.each(function(t){t.appendChild(document.createTextNode(e))}):1!==e.nodeType&&11!==e.nodeType||this.last()[0]&&this.last()[0].appendChild(e),t=null,this},attr:function(e,t){if(s.isObject(e))this.each(function(t){for(var n in e)if(e.hasOwnProperty(n))try{t.setAttribute(n,e[n])}catch(i){}});else if("string"==typeof e&&(e=s.trim(e))){if(arguments.length<=1){var n=this.first()[0];return n?n.getAttribute(e):null}this.each(function(n){n.setAttribute(e,t+"")})}return this},prop:function(e,t){if(s.isObject(e))this.each(function(t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])});else if("string"==typeof e&&(e=s.trim(e))){if(arguments.length<=1){var n=this.first()[0];return n?n[e]:null}this.each(function(n){n[e]=t})}return this},css:function(e,t){if(s.isObject(e))this.each(function(t){for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])});else if("string"==typeof e&&(e=s.trim(e))){if(1===arguments.length){var n=this.first()[0];return s.css(n,e)}arguments.length>=2&&this.each(function(n){n.style[e]=t})}return this},each:function(e){var t=this.length;if(t>0&&"function"==typeof e){var n,i=0;for(i;i<t;i++)n=this[i],e.call(n,n,i)}return this},on:function(n,r,o,a){var l=this;if(null==o&&(o=r,r=void 0),!o)return this;o.hasOwnProperty("guid")||(o.guid=++u);var c=s.trim(n).split(/\s+/);return c.length>0&&this.each(function(n){var u=e(n);c.forEach(function(e){f[e]=f[e]||[];var c=t(n,e);0===c.length&&n.addEventListener(e,i,!1);var h={guid:u,type:e,handler:o,selector:r,elem:n};1===a&&(h.handler=function(e){s.fn.off.call(l,e.type,r,h.handler),o.apply(n,arguments)},h.handler.guid=o.guid),f[e].push(h)})}),this},one:function(e,t,n){return s.fn.on.call(this,e,t,n,1),this},off:function(e,n,r){null==r&&(r=n,n=void 0);var o=s.trim(e).split(/\s+/);return o.length>0&&this.each(function(e){var s=e[c];void 0!==s&&o.forEach(function(o){var a=f[o];a&&(r?f[o]=a.filter(function(e){return e.guid!==s||e.selector!==n||e.handler.guid!==r.guid}):f[o]=a.filter(function(e){return e.guid!==s||e.selector!==n}),0===t(e,o).length&&e.removeEventListener(o,i,!1))})}),this},trigger:function(e,t){t=t||{bubbles:!0,cancelable:!0,detail:null};var i=n(e,t);return this.each(function(e){i.forEach(function(t){e.dispatchEvent(t)})}),this},addClass:function(e){return"string"==typeof e&&(e=s.trim(e))&&(e=e.split(/\s+/),this.each(function(t){var n=t.className.split(/\s+/);e.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),t.className=n.join(" ")})),this},removeClass:function(e){return"string"==typeof e&&(e=s.trim(e))&&(e=e.split(/\s+/),this.each(function(t){var n=t.className.split(/\s+/);e.forEach(function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}),t.className=n.join(" ")})),this},hasClass:function(e){if("string"==typeof e&&(e=s.trim(e))&&this.length>0){e=e.split(/\s+/);for(var t=!0,n=0;n<this.length;n++){var i=this[n];if(t=e.every(function(e){return-1!==i.className.split(/\s+/).indexOf(e)}),!t)return!1}return t}return!1},show:function(){return r(this,1),this},hide:function(){return r(this),this},html:function(e){if(!(arguments.length>0)){var t=this.first()[0];return t?t.innerHTML:""}return this.each(function(t){t.innerHTML=e+""}),this},text:function(e){if(!(arguments.length>0)){var t=this.first()[0];return t?t.textContent:""}return this.each(function(t){t.textContent=e+""}),this}},s.fn.init=function(e){var t=this;if(null==e)return t;if(1===e.nodeType)return t[0]=e,t.selector="",t.length=1,t;if(/^\[object (NodeList|HTMLCollection)]$/.test(d.call(e))){var n=Array.prototype.slice.call(e).filter(function(e){return 1===e.nodeType});return n.length>0&&(n.forEach(function(e,n){t[n]=e}),t.selector="",t.length=n.length),t}if(11===e.nodeType){var i=Array.prototype.slice.call(e.children);return i.length>0&&(i.forEach(function(e,n){t[n]=e}),t.selector="",t.length=i.length),t}if(e===window||e===document)return t[0]=e,t.selector="",t.length=1,t;if("string"==typeof e&&(e=s.trim(e))){var r,o;try{r=document.querySelectorAll(e),o=r.length}catch(a){}if(o>0){for(var l=0;l<o;l++)t[l]=r[l];t.selector=e,t.length=o}}return t},s.fn.init.prototype=s.fn,s});